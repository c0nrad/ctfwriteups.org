{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/writeup.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"src/app/services/vote.service\";\nimport * as i4 from \"src/app/services/comment.service\";\nimport * as i5 from \"src/app/services/user.service\";\nimport * as i6 from \"src/app/services/seen.service\";\nimport * as i7 from \"@angular/router\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"../../date-ago.pipe\";\nfunction TopComponent_option_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const category_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", category_r2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(category_r2);\n  }\n}\nfunction TopComponent_div_23_i_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"i\", 35);\n    i0.ɵɵlistener(\"click\", function TopComponent_div_23_i_4_Template_i_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const writeup_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.addVote(writeup_r3));\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TopComponent_div_23_i_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"i\", 36);\n    i0.ɵɵlistener(\"click\", function TopComponent_div_23_i_5_Template_i_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const writeup_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.removeVote(ctx_r12.getVote(writeup_r3), writeup_r3));\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TopComponent_div_23_span_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 37);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const tag_r15 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(tag_r15);\n  }\n}\nconst _c0 = function (a1) {\n  return [\"/writeups\", a1, \"edit\"];\n};\nfunction TopComponent_div_23_i_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"i\", 38);\n  }\n  if (rf & 2) {\n    const writeup_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(1, _c0, writeup_r3.id));\n  }\n}\nfunction TopComponent_div_23_div_28_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"hr\");\n    i0.ɵɵelementStart(2, \"p\", 40);\n    i0.ɵɵtext(3);\n    i0.ɵɵpipe(4, \"dateAgo\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const comment_r19 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\"\", comment_r19.username || \"Anonymous\", \" - \", i0.ɵɵpipeBind1(4, 3, comment_r19.ts), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(comment_r19.body);\n  }\n}\nfunction TopComponent_div_23_div_28_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"textarea\", 41);\n    i0.ɵɵlistener(\"ngModelChange\", function TopComponent_div_23_div_28_div_2_Template_textarea_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r22);\n      const writeup_r3 = i0.ɵɵnextContext(2).$implicit;\n      return i0.ɵɵresetView(writeup_r3.newComment.body = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"button\", 42);\n    i0.ɵɵlistener(\"click\", function TopComponent_div_23_div_28_div_2_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r22);\n      const writeup_r3 = i0.ɵɵnextContext(2).$implicit;\n      const ctx_r23 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r23.addComment(writeup_r3));\n    });\n    i0.ɵɵtext(3, \"Add Comment\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const writeup_r3 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", writeup_r3.newComment.body);\n  }\n}\nfunction TopComponent_div_23_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, TopComponent_div_23_div_28_div_1_Template, 7, 5, \"div\", 39);\n    i0.ɵɵtemplate(2, TopComponent_div_23_div_28_div_2_Template, 4, 1, \"div\", 34);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const writeup_r3 = i0.ɵɵnextContext().$implicit;\n    const ctx_r8 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", writeup_r3.comments);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r8.me.id);\n  }\n}\nconst _c1 = function (a1) {\n  return [\"/ctfs\", a1, \"edit\"];\n};\nfunction TopComponent_div_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r28 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 16)(1, \"div\", 17)(2, \"div\", 18)(3, \"div\", 19);\n    i0.ɵɵtemplate(4, TopComponent_div_23_i_4_Template, 1, 0, \"i\", 20);\n    i0.ɵɵtemplate(5, TopComponent_div_23_i_5_Template, 1, 0, \"i\", 21);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 22)(8, \"div\", 23)(9, \"div\", 24)(10, \"a\", 25);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"div\", 26);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementStart(14, \"span\", 27)(15, \"a\", 28);\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(17, \"div\", 29);\n    i0.ɵɵlistener(\"click\", function TopComponent_div_23_Template_div_click_17_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r28);\n      const writeup_r3 = restoredCtx.$implicit;\n      const ctx_r27 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r27.toggleWriteup(writeup_r3));\n    });\n    i0.ɵɵelement(18, \"i\", 30);\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"div\", 23)(21, \"div\", 24)(22, \"p\");\n    i0.ɵɵtext(23);\n    i0.ɵɵpipe(24, \"dateAgo\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(25, \"div\", 31);\n    i0.ɵɵtemplate(26, TopComponent_div_23_span_26_Template, 2, 1, \"span\", 32);\n    i0.ɵɵtemplate(27, TopComponent_div_23_i_27_Template, 1, 3, \"i\", 33);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(28, TopComponent_div_23_div_28_Template, 3, 2, \"div\", 34);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const writeup_r3 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.hasVoted(writeup_r3));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.hasVoted(writeup_r3));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", writeup_r3.voteCount, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(16, _c1, writeup_r3.ctfID));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", writeup_r3.ctfName, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", writeup_r3.challengeCategory, \" / \", writeup_r3.challengeName, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"href\", writeup_r3.url, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(writeup_r3.url);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(writeup_r3.commentCount || 0);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(24, 14, writeup_r3.ts));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", writeup_r3.tags);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.me.isAdmin || writeup_r3.submitterID == ctx_r1.me.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", writeup_r3.isExpanded);\n  }\n}\nexport class TopComponent {\n  constructor(writeupService, location, voteService, commentService, userService, seenService) {\n    this.writeupService = writeupService;\n    this.location = location;\n    this.voteService = voteService;\n    this.commentService = commentService;\n    this.userService = userService;\n    this.seenService = seenService;\n    this.me = {};\n    this.writeups = [];\n    this.votes = [];\n    this.seens = [];\n    this.sortBy = \"votes\";\n    this.durationFilter = \"week\";\n    this.categoryFilter = \"\";\n    this.categories = [];\n  }\n  ngOnInit() {\n    this.writeupService.getWriteups().subscribe(writeups => {\n      this.writeups = writeups || [];\n      this.writeups.forEach(writeup => {\n        writeup.newComment = {};\n        writeup.newComment.body = \"\";\n        writeup.isExpanded = false;\n        writeup.comments = writeup.comments || [];\n        this.categories.push(writeup.challengeCategory);\n      });\n      this.categories = this.categories.filter((v, i, a) => a.indexOf(v) === i);\n    });\n    this.voteService.getVotes().subscribe(votes => {\n      this.votes = votes || [];\n    });\n    this.seenService.getSeens().subscribe(seens => {\n      this.seens = seens || [];\n    });\n    this.userService.getMe().subscribe(me => {\n      this.me = me;\n    });\n  }\n  hasVoted(writeup) {\n    if (!this.votes) {}\n    return !!this.votes.find(v => v.writeupID === writeup.id);\n  }\n  getVote(writeup) {\n    return this.votes.find(v => v.writeupID === writeup.id);\n  }\n  addVote(writeup) {\n    const vote = {\n      writeupID: writeup.id,\n      userID: this.me.id\n    };\n    this.voteService.newVote(vote).subscribe(v => {\n      this.votes.push(v);\n      writeup.voteCount++;\n    });\n  }\n  addSeen(writeup) {\n    const seen = {\n      writeupID: writeup.id,\n      userID: this.me.id\n    };\n    this.seenService.newSeen(seen).subscribe(s => {\n      this.seens.push(s);\n    });\n  }\n  removeVote(vote, writeup) {\n    console.log(\"remove vote\", vote);\n    this.voteService.deleteVote(vote).subscribe(_ => {\n      this.votes = this.votes.filter(v => vote.id !== v.id);\n      writeup.voteCount--;\n    });\n  }\n  getDomain(u) {\n    return new URL(u).hostname;\n  }\n  filteredWriteups() {\n    let writeups = this.writeups;\n    if (this.categoryFilter) {\n      writeups = writeups.filter(w => w.challengeCategory === this.categoryFilter);\n    }\n    if (this.durationFilter === \"day\") {\n      writeups = writeups.filter(w => w.ctfEndDate * 1000 > Date.now() - 1000 * 60 * 60 * 24);\n    } else if (this.durationFilter === \"week\" || this.durationFilter === \"\") {\n      writeups = writeups.filter(w => w.ctfEndDate * 1000 > Date.now() - 1000 * 60 * 60 * 24 * 7);\n    } else if (this.durationFilter === \"month\") {\n      writeups = writeups.filter(w => w.ctfEndDate * 1000 > Date.now() - 1000 * 60 * 60 * 24 * 30);\n    }\n    if (this.sortBy === \"votes\" || this.sortBy == \"\") {\n      writeups = writeups.sort((a, b) => b.voteCount - a.voteCount);\n    } else if (this.sortBy == \"newest\") {\n      writeups = writeups.sort((a, b) => b.ts - a.ts);\n    } else if (this.sortBy == \"comments\") {\n      writeups = writeups.sort((a, b) => b.commentCount - a.commentCount);\n    }\n    return writeups;\n  }\n  toggleWriteup(writeup) {\n    writeup.isExpanded = !writeup.isExpanded;\n    if (writeup.isExpanded) {\n      this.commentService.getCommentsForWriteup(writeup.id).subscribe(comments => {\n        writeup.comments = comments;\n      });\n    }\n  }\n  addComment(writeup) {\n    writeup.newComment.writeupID = writeup.id;\n    writeup.newComment.userID = this.me.id;\n    this.commentService.newComment(writeup.newComment).subscribe(comment => {\n      writeup.comments.push(comment);\n      writeup.commentCount++;\n      writeup.newComment.body = \"\";\n    });\n  }\n  static #_ = this.ɵfac = function TopComponent_Factory(t) {\n    return new (t || TopComponent)(i0.ɵɵdirectiveInject(i1.WriteupService), i0.ɵɵdirectiveInject(i2.Location), i0.ɵɵdirectiveInject(i3.VoteService), i0.ɵɵdirectiveInject(i4.CommentService), i0.ɵɵdirectiveInject(i5.UserService), i0.ɵɵdirectiveInject(i6.SeenService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TopComponent,\n    selectors: [[\"app-top\"]],\n    decls: 24,\n    vars: 5,\n    consts: [[1, \"container\", 2, \"padding-top\", \"65px\"], [1, \"input-group\", \"mb-3\"], [1, \"form-select\", 3, \"ngModel\", \"ngModelChange\"], [\"value\", \"votes\"], [\"value\", \"newest\"], [\"value\", \"comments\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"form-select\", \"float-end\", 3, \"ngModel\", \"ngModelChange\"], [\"value\", \"day\"], [\"value\", \"week\"], [\"value\", \"month\"], [\"value\", \"all\"], [1, \"clearfix\"], [\"class\", \"card\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [1, \"card\"], [1, \"card-body\", \"py-1\"], [1, \"row\"], [1, \"col-1\"], [\"class\", \"bi bi-heart\", \"style\", \"font-size:1.2rem;  vertical-align: 0em;\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"bi bi-heart-fill text-danger\", \"style\", \"font-size: 1.2rem\", 3, \"click\", 4, \"ngIf\"], [1, \"col-11\"], [1, \"row\", \"pb-0\"], [1, \"col-2\"], [3, \"routerLink\"], [1, \"col-9\"], [2, \"padding-left\", \"5px\"], [\"rel\", \"noopener noreferrer\", \"target\", \"_blank\", 3, \"href\"], [1, \"col-1\", 3, \"click\"], [1, \"bi\", \"bi-chat\", \"me-1\"], [1, \"col-10\"], [\"class\", \"badge bg-secondary me-1\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"bi bi-pencil text-muted\", 3, \"routerLink\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"bi\", \"bi-heart\", 2, \"font-size\", \"1.2rem\", \"vertical-align\", \"0em\", 3, \"click\"], [1, \"bi\", \"bi-heart-fill\", \"text-danger\", 2, \"font-size\", \"1.2rem\", 3, \"click\"], [1, \"badge\", \"bg-secondary\", \"me-1\"], [1, \"bi\", \"bi-pencil\", \"text-muted\", 3, \"routerLink\"], [4, \"ngFor\", \"ngForOf\"], [1, \"text-muted\"], [1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"btn\", \"btn-primary\", 3, \"click\"]],\n    template: function TopComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"select\", 2);\n        i0.ɵɵlistener(\"ngModelChange\", function TopComponent_Template_select_ngModelChange_2_listener($event) {\n          return ctx.sortBy = $event;\n        });\n        i0.ɵɵelementStart(3, \"option\", 3);\n        i0.ɵɵtext(4, \"Votes\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"option\", 4);\n        i0.ɵɵtext(6, \"Newest\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"option\", 5);\n        i0.ɵɵtext(8, \"Comments\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(9, \"select\", 2);\n        i0.ɵɵlistener(\"ngModelChange\", function TopComponent_Template_select_ngModelChange_9_listener($event) {\n          return ctx.categoryFilter = $event;\n        });\n        i0.ɵɵelementStart(10, \"option\", 6);\n        i0.ɵɵtext(11, \"All Categories\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(12, TopComponent_option_12_Template, 2, 2, \"option\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"select\", 8);\n        i0.ɵɵlistener(\"ngModelChange\", function TopComponent_Template_select_ngModelChange_13_listener($event) {\n          return ctx.durationFilter = $event;\n        });\n        i0.ɵɵelementStart(14, \"option\", 9);\n        i0.ɵɵtext(15, \"Day\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"option\", 10);\n        i0.ɵɵtext(17, \"Week\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"option\", 11);\n        i0.ɵɵtext(19, \"Month\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"option\", 12);\n        i0.ɵɵtext(21, \"All Time\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelement(22, \"div\", 13);\n        i0.ɵɵtemplate(23, TopComponent_div_23_Template, 29, 18, \"div\", 14);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.sortBy);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngModel\", ctx.categoryFilter);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.categories);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngModel\", ctx.durationFilter);\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"ngForOf\", ctx.filteredWriteups());\n      }\n    },\n    dependencies: [i2.NgForOf, i2.NgIf, i7.RouterLink, i8.NgSelectOption, i8.ɵNgSelectMultipleOption, i8.DefaultValueAccessor, i8.SelectControlValueAccessor, i8.NgControlStatus, i8.NgModel, i9.DateAgoPipe]\n  });\n}","map":{"version":3,"mappings":"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","names":["i0","ctx_r12","TopComponent","constructor","writeupService","location","voteService","commentService","userService","seenService","ngOnInit","getWriteups","subscribe","writeups","forEach","writeup","newComment","body","isExpanded","comments","categories","push","challengeCategory","filter","v","i","a","indexOf","getVotes","votes","getSeens","seens","getMe","me","hasVoted","find","writeupID","id","getVote","addVote","vote","userID","newVote","voteCount","addSeen","seen","newSeen","s","removeVote","console","log","deleteVote","_","getDomain","u","URL","hostname","filteredWriteups","categoryFilter","w","durationFilter","ctfEndDate","Date","now","sortBy","sort","b","ts","commentCount","toggleWriteup","getCommentsForWriteup","addComment","comment","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["/Users/c0nrad/Projects/ctfwriteups.org/fe/src/app/pages/top/top.component.ts"],"sourcesContent":["import { Location } from \"@angular/common\";\nimport { Component } from \"@angular/core\";\nimport { CommentService, Comment } from \"src/app/services/comment.service\";\nimport { Seen, SeenService } from \"src/app/services/seen.service\";\nimport { User, UserService } from \"src/app/services/user.service\";\nimport { Vote, VoteService } from \"src/app/services/vote.service\";\nimport { Writeup, WriteupService } from \"src/app/services/writeup.service\";\n\n@Component({\n  selector: \"app-top\",\n  template: ` <div style=\"padding-top: 65px\" class=\"container\">\n    <div class=\"input-group mb-3\">\n      <select class=\"form-select\" [(ngModel)]=\"sortBy\">\n        <option value=\"votes\">Votes</option>\n        <option value=\"newest\">Newest</option>\n        <option value=\"comments\">Comments</option>\n      </select>\n\n      <select class=\"form-select\" [(ngModel)]=\"categoryFilter\">\n        <option value=\"\">All Categories</option>\n        <option *ngFor=\"let category of categories\" [value]=\"category\">{{ category }}</option>\n      </select>\n\n      <select class=\"form-select float-end\" [(ngModel)]=\"durationFilter\">\n        <option value=\"day\">Day</option>\n        <option value=\"week\">Week</option>\n        <option value=\"month\">Month</option>\n        <option value=\"all\">All Time</option>\n      </select>\n    </div>\n\n    <div class=\"clearfix\"></div>\n    <div *ngFor=\"let writeup of filteredWriteups()\" class=\"card\">\n      <div class=\"card-body py-1\">\n        <div class=\"row\">\n          <div class=\"col-1\">\n            <i *ngIf=\"!hasVoted(writeup)\" (click)=\"addVote(writeup)\" class=\"bi bi-heart\" style=\"font-size:1.2rem;  vertical-align: 0em;\"></i>\n            <i *ngIf=\"hasVoted(writeup)\" (click)=\"removeVote(getVote(writeup)!, writeup)\" class=\"bi bi-heart-fill text-danger\" style=\"font-size: 1.2rem\"></i>\n\n            {{ writeup.voteCount }}\n          </div>\n\n          <div class=\"col-11\">\n            <div class=\"row pb-0\">\n              <div class=\"col-2\">\n                <a [routerLink]=\"['/ctfs', writeup.ctfID, 'edit']\"> {{ writeup.ctfName }}</a>\n              </div>\n\n              <div class=\"col-9\">\n                {{ writeup.challengeCategory }} / {{ writeup.challengeName }}\n                <span style=\"padding-left: 5px\"\n                  ><a [href]=\"writeup.url\" rel=\"noopener noreferrer\" target=\"_blank\">{{ writeup.url }}</a></span\n                >\n              </div>\n\n              <div class=\"col-1\" (click)=\"toggleWriteup(writeup)\"><i class=\"bi bi-chat me-1\"></i>{{ writeup.commentCount || 0 }}</div>\n            </div>\n            <div class=\"row pb-0\">\n              <div class=\"col-2\">\n                <!-- <p>{{ writeup.body }}</p> -->\n                <p>{{ writeup.ts | dateAgo }}</p>\n              </div>\n              <div class=\"col-10\">\n                <span *ngFor=\"let tag of writeup.tags\" class=\"badge bg-secondary me-1\">{{ tag }}</span>\n                <i *ngIf=\"me.isAdmin || writeup.submitterID == me.id\" class=\"bi bi-pencil text-muted\" [routerLink]=\"['/writeups', writeup.id, 'edit']\"></i>\n              </div>\n            </div>\n\n            <div *ngIf=\"writeup.isExpanded\">\n              <div *ngFor=\"let comment of writeup.comments\">\n                <hr />\n                <p class=\"text-muted\">{{ comment.username || \"Anonymous\" }} - {{ comment.ts | dateAgo }}</p>\n                <p>{{ comment.body }}</p>\n              </div>\n\n              <div *ngIf=\"me.id\">\n                <textarea [(ngModel)]=\"writeup.newComment.body\" class=\"form-control\"></textarea>\n                <button (click)=\"addComment(writeup)\" class=\"btn btn-primary\">Add Comment</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>`,\n  styles: [\"\"],\n})\nexport class TopComponent {\n  me: User = {} as User;\n  writeups: Writeup[] = [];\n  votes: Vote[] = [];\n  seens: Seen[] = [];\n\n  sortBy = \"votes\";\n  durationFilter = \"week\";\n  categoryFilter = \"\";\n\n  categories: string[] = [];\n\n  constructor(\n    private writeupService: WriteupService,\n    private location: Location,\n    private voteService: VoteService,\n    private commentService: CommentService,\n    private userService: UserService,\n    private seenService: SeenService\n  ) {}\n\n  ngOnInit(): void {\n    this.writeupService.getWriteups().subscribe((writeups) => {\n      this.writeups = writeups || [];\n\n      this.writeups.forEach((writeup) => {\n        writeup.newComment = {} as Comment;\n        writeup.newComment.body = \"\";\n        writeup.isExpanded = false;\n        writeup.comments = writeup.comments || [];\n\n        this.categories.push(writeup.challengeCategory);\n      });\n\n      this.categories = this.categories.filter((v, i, a) => a.indexOf(v) === i);\n    });\n\n    this.voteService.getVotes().subscribe((votes) => {\n      this.votes = votes || [];\n    });\n\n    this.seenService.getSeens().subscribe((seens) => {\n      this.seens = seens || [];\n    });\n\n    this.userService.getMe().subscribe((me) => {\n      this.me = me;\n    });\n  }\n\n  hasVoted(writeup: Writeup): boolean {\n    if (!this.votes) {\n    }\n    return !!this.votes.find((v) => v.writeupID === writeup.id);\n  }\n\n  getVote(writeup: Writeup): Vote | undefined {\n    return this.votes.find((v) => v.writeupID === writeup.id);\n  }\n\n  addVote(writeup: Writeup): void {\n    const vote: Vote = {\n      writeupID: writeup.id,\n      userID: this.me.id,\n    } as Vote;\n\n    this.voteService.newVote(vote).subscribe((v) => {\n      this.votes.push(v);\n      writeup.voteCount++;\n    });\n  }\n\n  addSeen(writeup: Writeup): void {\n    const seen: Seen = {\n      writeupID: writeup.id,\n      userID: this.me.id,\n    } as Seen;\n    this.seenService.newSeen(seen).subscribe((s) => {\n      this.seens.push(s);\n    });\n  }\n\n  removeVote(vote: Vote, writeup: Writeup): void {\n    console.log(\"remove vote\", vote);\n    this.voteService.deleteVote(vote).subscribe((_) => {\n      this.votes = this.votes.filter((v) => vote.id !== v.id);\n      writeup.voteCount--;\n    });\n  }\n\n  getDomain(u: string): string {\n    return new URL(u).hostname;\n  }\n\n  filteredWriteups(): Writeup[] {\n    let writeups = this.writeups;\n    if (this.categoryFilter) {\n      writeups = writeups.filter((w) => w.challengeCategory === this.categoryFilter);\n    }\n\n    if (this.durationFilter === \"day\") {\n      writeups = writeups.filter((w) => w.ctfEndDate * 1000 > Date.now() - 1000 * 60 * 60 * 24);\n    } else if (this.durationFilter === \"week\" || this.durationFilter === \"\") {\n      writeups = writeups.filter((w) => w.ctfEndDate * 1000 > Date.now() - 1000 * 60 * 60 * 24 * 7);\n    } else if (this.durationFilter === \"month\") {\n      writeups = writeups.filter((w) => w.ctfEndDate * 1000 > Date.now() - 1000 * 60 * 60 * 24 * 30);\n    }\n\n    if (this.sortBy === \"votes\" || this.sortBy == \"\") {\n      writeups = writeups.sort((a, b) => b.voteCount - a.voteCount);\n    } else if (this.sortBy == \"newest\") {\n      writeups = writeups.sort((a, b) => b.ts - a.ts);\n    } else if (this.sortBy == \"comments\") {\n      writeups = writeups.sort((a, b) => b.commentCount - a.commentCount);\n    }\n\n    return writeups;\n  }\n\n  toggleWriteup(writeup: Writeup): void {\n    writeup.isExpanded = !writeup.isExpanded;\n\n    if (writeup.isExpanded) {\n      this.commentService.getCommentsForWriteup(writeup.id).subscribe((comments) => {\n        writeup.comments = comments;\n      });\n    }\n  }\n\n  addComment(writeup: Writeup): void {\n    writeup.newComment.writeupID = writeup.id;\n    writeup.newComment.userID = this.me.id;\n\n    this.commentService.newComment(writeup.newComment).subscribe((comment) => {\n      writeup.comments.push(comment);\n      writeup.commentCount++;\n      writeup.newComment.body = \"\";\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}